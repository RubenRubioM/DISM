<!DOCTYPE html>
<html>
<head>
   

    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">


    <!--Llamadas para las hojas de estilo de bootstrap-->

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <!--JQUERY -->
    <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    <!--JQUERY MOBILE -->

    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />

    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <!--JQUERY, Datatabla -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" />
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>

    <script type="text/javascript" src="cordova.js"></script>
    <!-- El atributo "async" es necesario para que RequireJS funcione en una aplicación de Windows. -->
    <!--<script type="text/javascript" data-main="scripts/startup" src="lib/require.2.1.8.js" async></script>-->
    <script type='text/javascript' src='http://www.bing.com/api/maps/mapcontrol?callback=GetMap&key=[AqphJZdvgCLdhp_ajUuuROok1O3_jHlHE0_FLN-o1STbqzYnTeGjchdE-0Nwp41N]' async defer></script>

    <script type='text/javascript'>
        function GetMap() {

            var map = new Microsoft.Maps.Map('#myMap', {
                credentials: 'AqphJZdvgCLdhp_ajUuuROok1O3_jHlHE0_FLN-o1STbqzYnTeGjchdE-0Nwp41N'
            });
            //Request the user's location
            navigator.geolocation.getCurrentPosition(function (position) {
                var loc = new Microsoft.Maps.Location(
                    position.coords.latitude,
                    position.coords.longitude);
                //Add a pushpin at the user's location.
                var pin = new Microsoft.Maps.Pushpin(loc);
                map.entities.push(pin);
                //Center the map on the user's location.
                map.setView({ center: loc, zoom: 15 });
            });


        }
    </script>

    <script>
        

        var datos;
        var datosfiltrados = [];
        var key = ' eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJydWJlbnNpcGFsYUBnbWFpbC5jb20iLCJqdGkiOiIwYzI0ZDVlMC1jODM0LTQ5YjAtYjQ3My02OWE0MDAzZWU4OGIiLCJpc3MiOiJBRU1FVCIsImlhdCI6MTUzNzE5OTE3NCwidXNlcklkIjoiMGMyNGQ1ZTAtYzgzNC00OWIwLWI0NzMtNjlhNDAwM2VlODhiIiwicm9sZSI6IiJ9.mVgNwU7E9xeMUbmZ3yJJNkuCXWR6EibEbj9WebDySCs ';
        var settings = {
            "async": true,
            "crossDomain": true,
            "url": "https://opendata.aemet.es/opendata/api/valores/climatologicos/inventarioestaciones/todasestaciones?api_key="+ key,
            "method": "GET",
            "headers": {
                "cache-control": "no-cache"
            }
        }
        $(document).on("pagecreate", "#index", function (event) {
            

            InicializarGrid();
        });
        function InicializarGrid() {
            
            $.ajax(settings).done(function (response) {

                /*
                    Esta primera peticion ajax nos devuelve este body
                    {
                      "descripcion": "exito",
                      "estado": 200,
                      "datos": "https://opendata.aemet.es/opendata/sh/651d566d",
                      "metadatos": "https://opendata.aemet.es/opendata/sh/0556af7a"
                    }

                    Con lo cual volveremos a hacer otra petición al valor "datos"
                */
                var j = 0;

                
                $.ajax(response.datos).done((response) => {
                    /*
                        Esta segunda peticion nos devuelve este body
                        [ {
                          "latitud" : "431825N",
                          "provincia" : "A CORUÑA",
                          "altitud" : "98",
                          "indicativo" : "1387E",
                          "nombre" : "A CORUÑA AEROPUERTO",
                          "indsinop" : "08002",
                          "longitud" : "082219W"
                        }
                    */
                    datos = JSON.parse(response);

                    datos.forEach(function (entry) {
                        if (true) {
                            datosfiltrados[j] = entry;
                            
                            j = j + 1;
                        }
                    });
                    tabla = $('#dataGrid').DataTable({
                        "data": datosfiltrados,
                        "columns": [
                            {
                                "data": "nombre"
                            },
                            {

                                "data": "latitud"
                            },
                            {

                                "data": "longitud"
                            },
                            {
                                "data": "indsinop"
                            }
                        ]
                    });

                })
                
            });
        }
    </script>

    <title>Practica1</title>
</head>
<body>

    <div data-role="page" id="index">
        <div data-role="header">
            <h1>Ejemplo Dataset</h1>
        </div>
        <div role="main" class="ui-content">
            <table id="dataGrid" class="table table-striped table-bordered" style="width:100%">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Latidud</th>
                        <th>Longitud</th>
                        <th>Idema</th>
                    </tr>
                </thead>
            </table>
        </div>
        <div data-role="footer">
            <h4>DISM 2018-2019</h4>
        </div>
    </div>

    <div id="myMap" style='position:relative;width:600px;height:400px;'></div>

</body>
</html>
